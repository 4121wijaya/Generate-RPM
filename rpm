<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate (RPM) Kurikulum 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mustard': '#D4A574',
                        'teal': '#5C9EAD',
                        'burnt-orange': '#CC6B49',
                        'cream': '#F5F1E8',
                        'olive': '#8B956D'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Righteous:wght@400&family=Inter:wght@400;500;600&display=swap');
        .retro-font { font-family: 'Righteous', cursive; }
        .modern-font { font-family: 'Inter', sans-serif; }
        .paper-texture {
            background: linear-gradient(45deg, #f9f7f4 25%, transparent 25%), 
                        linear-gradient(-45deg, #f9f7f4 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f9f7f4 75%), 
                        linear-gradient(-45deg, transparent 75%, #f9f7f4 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #5C9EAD;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .loading-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .chef-animation {
            font-size: 60px;
            animation: bounce 1.5s ease-in-out infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }
        
        .typing-animation {
            overflow: hidden;
            border-right: 3px solid #5C9EAD;
            white-space: nowrap;
            animation: typing 3s steps(40, end) infinite, blink-caret 0.75s step-end infinite;
        }
        
        @keyframes typing {
            0% { width: 0; }
            50% { width: 100%; }
            100% { width: 0; }
        }
        
        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: #5C9EAD; }
        }
        
        .success-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .success-popup.show {
            transform: translate(-50%, -50%) scale(1);
        }
        
        .success-icon {
            font-size: 80px;
            animation: successBounce 1.2s ease-in-out;
        }
        
        @keyframes successBounce {
            0% { transform: scale(0) rotate(0deg); }
            30% { transform: scale(1.3) rotate(10deg); }
            60% { transform: scale(0.9) rotate(-5deg); }
            80% { transform: scale(1.1) rotate(2deg); }
            100% { transform: scale(1) rotate(0deg); }
        }
        
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #D4A574;
            animation: confetti-fall 3s linear infinite;
        }
        
        .confetti:nth-child(2) { background: #5C9EAD; animation-delay: 0.5s; left: 20%; }
        .confetti:nth-child(3) { background: #CC6B49; animation-delay: 1s; left: 40%; }
        .confetti:nth-child(4) { background: #8B956D; animation-delay: 1.5s; left: 60%; }
        .confetti:nth-child(5) { background: #D4A574; animation-delay: 2s; left: 80%; }
        
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
    </style>
</head>
<body class="bg-cream min-h-screen modern-font">
    <!-- Header -->
    <header class="bg-teal shadow-lg">
        <div class="container mx-auto px-6 py-8">
            <h1 class="retro-font text-4xl md:text-5xl text-white text-center font-bold">
                üìö Generate (RPM) Kurikulum 2025
            </h1>
            <p class="text-center text-white/90 mt-2 text-lg italic">"Guru Haruslah Fokus untuk Mendidik, Mengayomi, dan Pendekatan secara Mendalam, terhadap Murid yang di Didiknya. Janganlah Terlalu Pusing Memikirkan Letter, terutama RPM, karena itu saya Berinovasi membuat Mesin Generate RPM ini Supaya Semua Guru di Indonesia tidak di Pusingkan dengan RPM, selamat Berkarya Bapak Ibu Guru di Indonesia. BERGERAK - BERKARYA - BERDAMPAK"</p>
            <p class="text-center text-white/80 mt-3 text-sm font-semibold">- Ari Wijaya - Dedikasi untuk Guru Indonesia</p>
        </div>
    </header>

    <div class="container mx-auto px-6 py-8 max-w-6xl">
        <!-- Form Input -->
        <div class="bg-white rounded-3xl shadow-xl p-8 mb-8 border-4 border-mustard">
            <h2 class="retro-font text-2xl text-burnt-orange mb-6 flex items-center">
                ‚úèÔ∏è Form Input Data
            </h2>
            
            <form id="rppForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-2">
                    <label class="block text-olive font-semibold">Nama Sekolah</label>
                    <input type="text" id="namaSekolah" class="w-full p-4 border-2 border-mustard rounded-2xl focus:border-teal outline-none" placeholder="Contoh: SEKOLAH SD-SMP-SMA-SMK" required>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-olive font-semibold">URL Logo Sekolah</label>
                    <input type="url" id="logoSekolah" class="w-full p-4 border-2 border-mustard rounded-2xl focus:border-teal outline-none" placeholder="https://example.com/logo.png">
                </div>
                
                <div class="space-y-2">
                    <label class="block text-olive font-semibold">Nama Kepala Sekolah</label>
                    <input type="text" id="namaKepsek" class="w-full p-4 border-2 border-mustard rounded-2xl focus:border-teal outline-none" placeholder="Contoh: Dr. Ahmad Suryadi, M.Pd" required>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-olive font-semibold">NIP Kepala Sekolah</label>
                    <input type="text" id="nipKepsek" class="w-full p-4 border-2 border-mustard rounded-2xl focus:border-teal outline-none" placeholder="Contoh: 196501011990031001" required>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-olive font-semibold">Nama Guru</label>
                    <input type="text" id="namaGuru" class="w-full p-4 border-2 border-mustard rounded-2xl focus:border-teal outline-none" placeholder="Contoh: Ari Wijaya" required>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-olive font-semibold">NIP Guru</label>
                    <input type="text" id="nipGuru" class="w-full p-4 border-2 border-mustard rounded-2xl focus:border-teal outline-none" placeholder="Contoh: 198203152006042001" required>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-olive font-semibold">Mata Pelajaran</label>
                    <input type="text" id="mataPelajaran" class="w-full p-4 border-2 border-mustard rounded-2xl focus:border-teal outline-none" placeholder="Contoh: Koding dan Kecerdasan Artifisial" required>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-olive font-semibold">Kelas</label>
                    <input type="text" id="kelas" class="w-full p-4 border-2 border-mustard rounded-2xl focus:border-teal outline-none" placeholder="Contoh: X IPA 1" required>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-olive font-semibold">Tahun Ajaran</label>
                    <input type="text" id="tahunAjaran" class="w-full p-4 border-2 border-mustard rounded-2xl focus:border-teal outline-none" placeholder="Contoh: 2024/2025" required>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-olive font-semibold">Frase/Tema Pembelajaran</label>
                    <input type="text" id="frase" class="w-full p-4 border-2 border-mustard rounded-2xl focus:border-teal outline-none" placeholder="Contoh: Sistem Persamaan Linear" required>
                </div>
            </form>
            
            <button type="button" id="generateBtn" class="w-full mt-8 bg-burnt-orange hover:bg-burnt-orange/90 text-white font-bold py-4 px-8 rounded-2xl text-xl retro-font shadow-lg transition-all duration-300 flex items-center justify-center gap-3 cursor-pointer">
                <span id="btnText">üöÄ Generate RPM</span>
                <div id="loadingSpinner" class="loading-spinner hidden"></div>
            </button>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay hidden">
            <div class="loading-content">
                <div class="chef-animation">üë®‚Äçüç≥</div>
                <h3 class="text-2xl font-bold text-teal mt-4 mb-2">Bapak Ari Wijaya</h3>
                <div class="typing-animation text-lg text-gray-700">Mohon Tunggu Sebentar, Bapak Ari Wijaya sedang meracik RPM Anda</div>
                <div class="mt-4">
                    <div class="loading-spinner mx-auto"></div>
                </div>
            </div>
        </div>

        <!-- Success Popup -->
        <div id="successPopup" class="success-popup">
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="confetti"></div>
            <div class="success-icon">üéâ</div>
            <h3 class="text-2xl font-bold text-teal mt-4 mb-2">RPM Anda sudah berhasil dibuat!</h3>
            <p class="text-lg text-gray-700 mb-6">Silahkan download</p>
            <button id="closeSuccessPopup" class="bg-teal hover:bg-teal/90 text-white px-6 py-3 rounded-xl font-semibold">
                Lihat RPM
            </button>
        </div>

        <!-- Preview Results -->
        <div id="previewSection" class="bg-gradient-to-br from-cream to-white rounded-3xl shadow-2xl p-8 border-4 border-mustard relative overflow-hidden hidden">
            <!-- Retro Document Header -->
            <div class="flex justify-between items-center mb-8 bg-teal/10 p-6 rounded-2xl border-2 border-teal/20">
                <div class="flex items-center gap-4">
                    <div class="bg-teal p-3 rounded-full">
                        <span class="text-2xl">üìã</span>
                    </div>
                    <div>
                        <h2 class="retro-font text-3xl text-teal">Preview RPM</h2>
                        <p class="text-teal/70 font-medium">Dokumen Pembelajaran Profesional</p>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button id="downloadWord" class="bg-mustard hover:bg-mustard/90 text-white px-6 py-3 rounded-xl font-semibold flex items-center gap-2 shadow-lg transition-all duration-300 hover:shadow-xl hover:scale-105">
                        üìÑ Word
                    </button>
                    <button id="downloadExcel" class="bg-olive hover:bg-olive/90 text-white px-6 py-3 rounded-xl font-semibold flex items-center gap-2 shadow-lg transition-all duration-300 hover:shadow-xl hover:scale-105">
                        üìä Excel
                    </button>
                </div>
            </div>
            
            <!-- Retro Document Frame -->
            <div class="relative">
                <!-- Paper Corner Fold Effect -->
                <div class="absolute -top-2 -right-2 w-8 h-8 bg-gradient-to-br from-gray-200 to-gray-300 transform rotate-45 shadow-md"></div>
                
                <!-- Main Document -->
                <div id="rppContent" class="bg-gradient-to-br from-white via-cream/30 to-white p-12 rounded-2xl shadow-2xl border-4 border-mustard/30 relative overflow-hidden">
                    <!-- Vintage Paper Texture Overlay -->
                    <div class="absolute inset-0 opacity-5 bg-gradient-to-br from-mustard via-transparent to-teal pointer-events-none"></div>
                    
                    <!-- Content will be generated here -->
                    <div class="relative z-10" id="rppContentContainer">
                        <div class="text-center py-20">
                            <div class="text-6xl mb-4">üìù</div>
                            <h3 class="text-2xl font-bold text-teal mb-2">Preview RPM</h3>
                            <p class="text-gray-600">Silahkan isi form dan klik "Generate RPM" untuk melihat preview</p>
                        </div>
                    </div>
                    
                    <!-- Decorative Elements -->
                    <div class="absolute top-4 left-4 w-2 h-2 bg-mustard/20 rounded-full"></div>
                    <div class="absolute top-4 right-4 w-2 h-2 bg-teal/20 rounded-full"></div>
                    <div class="absolute bottom-4 left-4 w-2 h-2 bg-olive/20 rounded-full"></div>
                    <div class="absolute bottom-4 right-4 w-2 h-2 bg-burnt-orange/20 rounded-full"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Footer -->
    <footer class="bg-teal text-white py-6 mt-16">
        <div class="container mx-auto px-6 text-center">
            <p class="text-lg font-semibold">¬© 2025 Powered by Ari Wijaya | Developer</p>
            <p class="text-base mt-4">
                Bagi Bapak Ibu yang ingin Donasi untuk Biaya Kuliah bisa 
                <button id="donationBtn" class="bg-mustard hover:bg-mustard/90 text-white px-4 py-2 rounded-xl font-semibold cursor-pointer transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 mx-2">
                    üíù klik di sini
                </button> 
                secara sukarela
            </p>
        </div>
    </footer>

    <!-- Donation Popup -->
    <div id="donationPopup" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-3xl p-8 max-w-md mx-4 shadow-2xl transform scale-95 transition-transform duration-300">
            <div class="text-center">
                <div class="text-6xl mb-4">üíù</div>
                <h3 class="text-2xl font-bold text-teal mb-4 retro-font">Donasi Sukarela</h3>
                <p class="text-gray-700 mb-6">Terima kasih atas niat baik Bapak/Ibu untuk membantu biaya kuliah</p>
                
                <div class="bg-gradient-to-r from-teal/10 to-mustard/10 p-6 rounded-2xl border-2 border-teal/20 mb-6">
                    <div class="flex items-center justify-center gap-3 mb-3">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjQwIiBoZWlnaHQ9IjQwIiByeD0iOCIgZmlsbD0iIzAwNTFBNSIvPgo8dGV4dCB4PSI1IiB5PSIyNSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0id2hpdGUiPkJDQTwvdGV4dD4KPC9zdmc+" alt="BCA" class="w-10 h-10">
                        <h4 class="text-xl font-bold text-gray-800">BANK BCA</h4>
                    </div>
                    <div class="bg-white p-4 rounded-xl border border-gray-200">
                        <p class="text-sm text-gray-600 mb-2">Nomor Rekening:</p>
                        <p class="text-2xl font-bold text-teal mb-3 font-mono tracking-wider" id="accountNumber">4640123414</p>
                        <p class="text-sm text-gray-600 mb-1">Atas Nama:</p>
                        <p class="text-lg font-bold text-gray-800">ARI WIJAYA</p>
                    </div>
                </div>
                
                <div class="flex gap-3">
                    <button id="copyAccountBtn" class="flex-1 bg-mustard hover:bg-mustard/90 text-white px-4 py-3 rounded-xl font-semibold flex items-center justify-center gap-2 transition-all duration-300">
                        üìã Salin Rekening
                    </button>
                    <button id="closeDonationPopup" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-xl font-semibold transition-all duration-300">
                        Tutup
                    </button>
                </div>
                
                <p class="text-xs text-gray-500 mt-4 italic">
                    Donasi bersifat sukarela dan akan sangat membantu kelanjutan pendidikan
                </p>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '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';
        
        let generatedRPP = null;

        // Main generate function
        async function handleGenerate() {
            console.log('Generate function called!'); // Debug log
            
            // Validate required fields
            const requiredFields = ['namaSekolah', 'namaKepsek', 'nipKepsek', 'namaGuru', 'nipGuru', 'mataPelajaran', 'kelas', 'tahunAjaran', 'frase'];
            let isValid = true;
            
            for (let field of requiredFields) {
                const input = document.getElementById(field);
                if (!input.value.trim()) {
                    input.classList.add('border-red-500');
                    isValid = false;
                } else {
                    input.classList.remove('border-red-500');
                }
            }
            
            if (!isValid) {
                alert('Mohon lengkapi semua field yang wajib diisi!');
                return;
            }

            // Show loading overlay
            document.getElementById('loadingOverlay').classList.remove('hidden');
            document.body.style.overflow = 'hidden'; // Prevent scrolling

            try {
                const rppData = {
                    namaSekolah: document.getElementById('namaSekolah').value,
                    logoSekolah: document.getElementById('logoSekolah').value,
                    namaKepsek: document.getElementById('namaKepsek').value,
                    nipKepsek: document.getElementById('nipKepsek').value,
                    namaGuru: document.getElementById('namaGuru').value,
                    nipGuru: document.getElementById('nipGuru').value,
                    mataPelajaran: document.getElementById('mataPelajaran').value,
                    kelas: document.getElementById('kelas').value,
                    tahunAjaran: document.getElementById('tahunAjaran').value,
                    frase: document.getElementById('frase').value
                };

                console.log('Generating RPM with data:', rppData); // Debug log
                const rpmContent = await generateRPM(rppData);
                console.log('Generated RPM content:', rpmContent); // Debug log
                displayRPM(rpmContent, rppData);
                console.log('RPM displayed successfully'); // Debug log
                
                // Hide loading overlay
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.body.style.overflow = 'auto'; // Restore scrolling
                
                // Show success popup immediately
                const successPopup = document.getElementById('successPopup');
                successPopup.classList.add('show');
                console.log('Success popup shown');
                
                // Auto close popup and show preview after 2 seconds
                setTimeout(() => {
                    successPopup.classList.remove('show');
                    const previewSection = document.getElementById('previewSection');
                    previewSection.classList.remove('hidden');
                    previewSection.scrollIntoView({ behavior: 'smooth' });
                    console.log('Preview section displayed and scrolled to');
                }, 2000);
                
            } catch (error) {
                console.error('Error generating RPP:', error);
                document.getElementById('loadingOverlay').classList.add('hidden');
                document.body.style.overflow = 'auto'; // Restore scrolling
                alert('Terjadi kesalahan saat generate RPM. Silakan coba lagi. Error: ' + error.message);
            }
        }

        // Event listener untuk tombol generate
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up button...');
            const generateBtn = document.getElementById('generateBtn');
            if (generateBtn) {
                console.log('Button found, adding event listener...');
                generateBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Button clicked!');
                    handleGenerate();
                });
            } else {
                console.error('Generate button not found!');
            }
        });

        async function generateRPM(data) {
            // Fallback content if API fails
            const fallbackRPM = `**RENCANA PEMBELAJARAN MENDALAM (RPM)**

**IDENTITAS PEMBELAJARAN**
Satuan Pendidikan: ${data.namaSekolah}
Mata Pelajaran: ${data.mataPelajaran}
Kelas/Semester: ${data.kelas}/1
Materi Pokok: ${data.frase}
Alokasi Waktu: 2 x 45 menit

**CAPAIAN PEMBELAJARAN (CP)**

| No | Elemen CP | Deskripsi Capaian | Indikator Pencapaian | Level Kognitif |
|---|---|---|---|---|
| 1 | Pemahaman Konsep | Memahami konsep dasar ${data.frase} secara komprehensif | Dapat menjelaskan definisi dan karakteristik ${data.frase} | C2 (Memahami) |
| 2 | Analisis Aplikasi | Menganalisis penerapan ${data.frase} dalam konteks nyata | Mampu mengidentifikasi contoh penerapan dalam kehidupan | C4 (Menganalisis) |
| 3 | Sintesis Solusi | Merancang solusi menggunakan prinsip ${data.frase} | Dapat membuat rancangan solusi untuk masalah spesifik | C5 (Mengevaluasi) |
| 4 | Evaluasi Kritis | Mengevaluasi efektivitas penerapan ${data.frase} | Mampu menilai kelebihan dan kekurangan suatu penerapan | C6 (Mencipta) |

**TUJUAN PEMBELAJARAN (TP)**

| No | Tujuan Pembelajaran | Indikator Keberhasilan | Metode Pencapaian | Waktu | Penilaian |
|---|---|---|---|---|---|
| 1 | Siswa dapat mengidentifikasi konsep ${data.frase} | Menyebutkan minimal 5 karakteristik utama | Ceramah interaktif & diskusi | 15 menit | Tes lisan |
| 2 | Siswa dapat menganalisis penerapan ${data.frase} | Menganalisis 3 contoh kasus nyata | Problem-based learning | 20 menit | Analisis kasus |
| 3 | Siswa dapat menyelesaikan masalah terkait ${data.frase} | Menyelesaikan 80% soal dengan benar | Latihan terbimbing | 25 menit | Tes tertulis |
| 4 | Siswa dapat mempresentasikan hasil analisis | Presentasi dengan struktur yang jelas | Presentasi kelompok | 15 menit | Rubrik presentasi |
| 5 | Siswa dapat mengevaluasi solusi ${data.frase} | Memberikan penilaian objektif terhadap solusi | Peer assessment | 10 menit | Lembar evaluasi |
| 6 | Siswa dapat mencipta inovasi berbasis ${data.frase} | Menghasilkan 1 ide inovatif yang aplikatif | Project-based learning | 25 menit | Portofolio |

**ALUR TUJUAN PEMBELAJARAN (ATP)**

| Tahap | Kegiatan Pembelajaran | Tujuan Spesifik | Durasi | Indikator Keberhasilan | Metode | Media/Alat |
|---|---|---|---|---|---|---|
| 1 | Apersepsi & Motivasi | Membangun minat belajar | 5 menit | Siswa antusias mengikuti pembelajaran | Tanya jawab | Video motivasi |
| 2 | Pengenalan Konsep | Memahami definisi ${data.frase} | 10 menit | Siswa dapat mendefinisikan konsep | Ceramah interaktif | Slide presentasi |
| 3 | Eksplorasi Teori | Mendalami teori ${data.frase} | 15 menit | Siswa memahami teori dasar | Diskusi kelompok | Buku teks |
| 4 | Analisis Contoh | Menganalisis kasus nyata | 15 menit | Siswa dapat menganalisis contoh | Case study | Lembar kasus |
| 5 | Latihan Terbimbing | Menyelesaikan soal dasar | 20 menit | Siswa menyelesaikan 80% soal | Guided practice | Lembar kerja |
| 6 | Latihan Mandiri | Mengerjakan soal kompleks | 15 menit | Siswa bekerja mandiri | Independent work | Soal latihan |
| 7 | Presentasi Hasil | Mempresentasikan solusi | 10 menit | Siswa presentasi dengan percaya diri | Presentasi | Proyektor |
| 8 | Evaluasi & Refleksi | Mengevaluasi pembelajaran | 10 menit | Siswa dapat merefleksi pembelajaran | Refleksi | Lembar refleksi |

**PROFIL PELAJAR PANCASILA**
- Bernalar Kritis: Menganalisis masalah secara sistematis
- Kreatif: Mencari solusi inovatif
- Gotong Royong: Bekerja sama dalam kelompok

**METODE PEMBELAJARAN**
Model: Problem Based Learning (PBL)
Pendekatan: Saintifik (5M: Mengamati, Menanya, Mengumpulkan informasi, Mengasosiasi, Mengkomunikasikan)

**MEDIA & BAHAN AJAR**
- Laptop/Komputer
- Proyektor
- Buku teks ${data.mataPelajaran}
- Lembar kerja siswa
- Video pembelajaran

**KEGIATAN PEMBELAJARAN**

A. PEMBUKAAN (15 menit)
- Guru membuka pembelajaran dengan salam dan doa
- Guru mengecek kehadiran siswa
- Apersepsi: Mengaitkan materi dengan pengalaman siswa
- Menyampaikan tujuan pembelajaran

B. KEGIATAN INTI (60 menit)
1. Mengamati (10 menit)
   - Siswa mengamati fenomena terkait ${data.frase}
   - Guru menampilkan video/gambar ilustrasi

2. Menanya (10 menit)
   - Siswa merumuskan pertanyaan terkait pengamatan
   - Guru memfasilitasi diskusi

3. Mengumpulkan Informasi (20 menit)
   - Siswa mencari informasi dari berbagai sumber
   - Kerja kelompok untuk menganalisis data

4. Mengasosiasi (15 menit)
   - Siswa mengolah informasi yang diperoleh
   - Membuat kesimpulan sementara

5. Mengkomunikasikan (5 menit)
   - Presentasi hasil diskusi kelompok
   - Tanya jawab antar kelompok

C. PENUTUP (15 menit)
- Guru dan siswa menyimpulkan pembelajaran
- Refleksi: Apa yang sudah dipelajari hari ini?
- Penugasan untuk pertemuan selanjutnya
- Doa penutup

**PENILAIAN**

**A. PENILAIAN SIKAP**

| No | Aspek Sikap | Indikator | Teknik Penilaian | Instrumen | Bobot (%) | Rumus Penilaian |
|---|---|---|---|---|---|---|
| 1 | Kedisiplinan | Hadir tepat waktu dan mengikuti aturan | Observasi | Lembar observasi | 20% | (Skor/4) √ó 100 |
| 2 | Tanggung Jawab | Menyelesaikan tugas dengan baik | Observasi | Jurnal sikap | 25% | (Skor/4) √ó 100 |
| 3 | Kerjasama | Berpartisipasi aktif dalam kelompok | Peer assessment | Lembar penilaian teman | 20% | (Skor/4) √ó 100 |
| 4 | Komunikasi | Menyampaikan pendapat dengan sopan | Observasi | Rubrik komunikasi | 20% | (Skor/4) √ó 100 |
| 5 | Kreativitas | Menunjukkan ide-ide inovatif | Self assessment | Lembar refleksi | 15% | (Skor/4) √ó 100 |

**B. PENILAIAN PENGETAHUAN**

| No | Aspek Pengetahuan | Indikator | Teknik Penilaian | Instrumen | Bobot (%) | KKM | Rumus Penilaian |
|---|---|---|---|---|---|---|---|
| 1 | Pemahaman Konsep | Menjelaskan definisi ${data.frase} | Tes tertulis | Soal essay | 25% | 75 | (Benar/Total) √ó 100 |
| 2 | Analisis Teori | Menganalisis teori ${data.frase} | Tes tertulis | Soal analisis | 20% | 75 | (Skor/20) √ó 100 |
| 3 | Aplikasi Rumus | Menerapkan rumus dalam soal | Tes tertulis | Soal hitungan | 25% | 75 | (Benar/Total) √ó 100 |
| 4 | Evaluasi Kasus | Mengevaluasi studi kasus | Penugasan | Lembar kasus | 15% | 75 | (Skor/15) √ó 100 |
| 5 | Sintesis Informasi | Menggabungkan berbagai konsep | Tes lisan | Panduan wawancara | 10% | 75 | (Skor/10) √ó 100 |
| 6 | Pemecahan Masalah | Menyelesaikan masalah kompleks | Tes praktik | Soal pemecahan masalah | 5% | 75 | (Langkah benar/Total) √ó 100 |

**C. PENILAIAN KETERAMPILAN**

| No | Aspek Keterampilan | Indikator | Teknik Penilaian | Instrumen | Bobot (%) | Kriteria | Rumus Penilaian |
|---|---|---|---|---|---|---|---|
| 1 | Keterampilan Presentasi | Menyajikan hasil dengan jelas | Penilaian kinerja | Rubrik presentasi | 25% | Sangat Baik (4) | (Skor/16) √ó 100 |
| 2 | Keterampilan Analisis | Menganalisis data dengan tepat | Penilaian produk | Lembar analisis | 20% | Baik (3) | (Skor/12) √ó 100 |
| 3 | Keterampilan Praktik | Melakukan praktik ${data.frase} | Penilaian praktik | Lembar observasi praktik | 25% | Cukup (2) | (Skor/8) √ó 100 |
| 4 | Keterampilan Kolaborasi | Bekerja sama dalam tim | Penilaian proyek | Rubrik kerja tim | 15% | Kurang (1) | (Skor/4) √ó 100 |
| 5 | Keterampilan Digital | Menggunakan teknologi dengan baik | Penilaian portofolio | Checklist digital | 15% | - | (Item checklist/Total) √ó 100 |

**D. RUMUS PENILAIAN AKHIR:**
- **Nilai Akhir = (Sikap √ó 20%) + (Pengetahuan √ó 40%) + (Keterampilan √ó 40%)**
- **Konversi Nilai:** A (90-100), B (80-89), C (70-79), D (60-69)
- **Remedial:** Nilai < 75 ‚Üí Pembelajaran ulang + tes remedial
- **Pengayaan:** Nilai ‚â• 90 ‚Üí Tugas proyek lanjutan

**PENGAYAAN & REMEDIAL**
- Pengayaan: Tugas proyek lanjutan untuk siswa yang sudah tuntas
- Remedial: Pembelajaran ulang dengan metode berbeda untuk siswa yang belum tuntas

**REFLEKSI GURU**
- Evaluasi ketercapaian tujuan pembelajaran
- Identifikasi kendala dan solusi
- Rencana perbaikan untuk pembelajaran selanjutnya`;

            const prompt = `Sebagai AI ChatGPT yang merupakan pakar pendidikan Indonesia dengan keahlian khusus dalam penyusunan dokumen pembelajaran profesional, buatkan RPP (Rencana Pelaksanaan Pembelajaran) yang sangat komprehensif, detail, dan berkualitas tinggi untuk Kurikulum 2025 dengan spesifikasi berikut:

INFORMASI PEMBELAJARAN:
- Mata Pelajaran: ${data.mataPelajaran}
- Kelas: ${data.kelas}
- Tema/Materi: ${data.frase}
- Sekolah: ${data.namaSekolah}
- Guru: ${data.namaGuru}
- Tahun Ajaran: ${data.tahunAjaran}

INSTRUKSI KHUSUS UNTUK PENYUSUNAN RPP PROFESIONAL:

**1. IDENTITAS PEMBELAJARAN (Lengkap dan Terstruktur)**
- Satuan Pendidikan, Mata Pelajaran, Kelas/Semester, Materi Pokok, Sub Materi, Alokasi Waktu (detail per pertemuan), Jumlah Pertemuan

**2. CAPAIAN PEMBELAJARAN (CP) - WAJIB DALAM FORMAT TABEL**
Buat tabel dengan kolom:
| No | Elemen CP | Deskripsi Capaian | Indikator Pencapaian | Level Kognitif |
Minimal 4-5 elemen CP yang spesifik untuk ${data.mataPelajaran} dengan materi ${data.frase}
- Sesuaikan dengan karakteristik siswa kelas ${data.kelas}
- Gunakan kata kerja operasional Bloom yang terukur
- Integrasikan dengan Profil Pelajar Pancasila

**3. TUJUAN PEMBELAJARAN (TP) - WAJIB DALAM FORMAT TABEL**
Buat tabel dengan kolom:
| No | Tujuan Pembelajaran | Indikator Keberhasilan | Metode Pencapaian | Waktu | Penilaian |
Minimal 6-8 TP yang sangat detail dan spesifik untuk materi ${data.frase}
- Gunakan formula ABCD (Audience, Behavior, Condition, Degree)
- Setiap TP harus SMART (Specific, Measurable, Achievable, Relevant, Time-bound)
- Berikan kriteria keberhasilan yang jelas dan terukur

**4. ALUR TUJUAN PEMBELAJARAN (ATP) - WAJIB DALAM FORMAT TABEL**
Buat tabel dengan kolom:
| Tahap | Kegiatan Pembelajaran | Tujuan Spesifik | Durasi | Indikator Keberhasilan | Metode | Media/Alat |
Minimal 8-10 tahap pembelajaran yang sistematis dan berurutan
- Tunjukkan progres dari pengetahuan dasar hingga aplikasi kompleks
- Setiap tahap harus logis dan saling berkaitan
- Sertakan estimasi waktu yang realistis

**5. PROFIL PELAJAR PANCASILA - Terintegrasi**
- Pilih minimal 3 dimensi yang relevan dengan materi ${data.frase}
- Jelaskan secara detail bagaimana setiap dimensi akan dikembangkan
- Berikan contoh konkret implementasi dalam pembelajaran

**6. MODEL DAN METODE PEMBELAJARAN - Inovatif dan Efektif**
- Pilih model pembelajaran yang paling sesuai (PBL, PjBL, Discovery Learning, dll)
- Jelaskan sintaks model pembelajaran secara detail
- Sertakan strategi pembelajaran yang variatif

**7. MEDIA, ALAT, DAN SUMBER BELAJAR - Komprehensif**
- Media pembelajaran digital dan konvensional
- Alat dan bahan yang dibutuhkan (spesifik)
- Sumber belajar primer dan sekunder yang kredibel
- Platform teknologi yang akan digunakan

**8. KEGIATAN PEMBELAJARAN - Sangat Detail dan Terstruktur**

A. KEGIATAN PENDAHULUAN (15 menit):
   - Orientasi dan pembukaan yang menarik
   - Apersepsi yang menghubungkan dengan pengalaman siswa
   - Motivasi yang relevan dengan materi
   - Penyampaian tujuan dan cakupan materi
   - Pre-assessment singkat

B. KEGIATAN INTI (60 menit):
   - Tahap 1: [Sesuai sintaks model pembelajaran yang dipilih]
   - Tahap 2: [Lanjutan sintaks dengan aktivitas spesifik]
   - Tahap 3: [Pendalaman materi dengan contoh konkret]
   - Tahap 4: [Aplikasi dan latihan terbimbing]
   - Tahap 5: [Evaluasi formatif dan umpan balik]
   - Sertakan dialog pembelajaran dan pertanyaan kunci

C. KEGIATAN PENUTUP (15 menit):
   - Kesimpulan kolaboratif guru-siswa
   - Refleksi pembelajaran yang mendalam
   - Evaluasi ketercapaian tujuan
   - Penugasan terstruktur dan mandiri
   - Preview materi pertemuan berikutnya

**9. ASESMEN/PENILAIAN - WAJIB DALAM FORMAT TABEL DENGAN RUMUS**

A. TABEL PENILAIAN SIKAP:
| No | Aspek Sikap | Indikator | Teknik Penilaian | Instrumen | Bobot (%) | Rumus Penilaian |
Minimal 5 aspek sikap yang relevan dengan materi ${data.frase}

B. TABEL PENILAIAN PENGETAHUAN:
| No | Aspek Pengetahuan | Indikator | Teknik Penilaian | Instrumen | Bobot (%) | KKM | Rumus Penilaian |
Minimal 6 aspek pengetahuan yang terukur untuk ${data.mataPelajaran}

C. TABEL PENILAIAN KETERAMPILAN:
| No | Aspek Keterampilan | Indikator | Teknik Penilaian | Instrumen | Bobot (%) | Kriteria | Rumus Penilaian |
Minimal 5 aspek keterampilan praktis untuk materi ${data.frase}

D. RUMUS PENILAIAN AKHIR:
- Nilai Akhir = (Sikap √ó 20%) + (Pengetahuan √ó 40%) + (Keterampilan √ó 40%)
- Konversi nilai: A (90-100), B (80-89), C (70-79), D (60-69)
- Sertakan rumus remedial dan pengayaan

**10. PROGRAM TINDAK LANJUT**
- Pengayaan: Kegiatan lanjutan untuk siswa yang sudah tuntas
- Remedial: Program perbaikan untuk siswa yang belum tuntas
- Strategi pembelajaran diferensiasi

**11. REFLEKSI GURU DAN EVALUASI PEMBELAJARAN**
- Analisis ketercapaian tujuan pembelajaran
- Identifikasi kendala dan solusi
- Rencana perbaikan untuk pertemuan selanjutnya
- Catatan untuk pengembangan profesional

STANDAR KUALITAS YANG HARUS DIPENUHI:
- Gunakan bahasa Indonesia baku dan formal sesuai EYD
- Terminologi pendidikan yang tepat dan konsisten
- Struktur kalimat yang jelas dan mudah dipahami
- Konten yang praktis dan dapat diimplementasikan
- Sesuai dengan perkembangan psikologi siswa kelas ${data.kelas}
- Mengintegrasikan teknologi pembelajaran modern
- Mempertimbangkan keberagaman gaya belajar siswa
- Minimal 3000 kata dengan detail yang komprehensif

FOKUS KHUSUS UNTUK MATA PELAJARAN "${data.mataPelajaran}":
- Sertakan aspek praktis dan aplikatif
- Integrasikan teknologi terkini yang relevan
- Kembangkan kemampuan berpikir komputasional
- Tekankan pada problem solving dan critical thinking
- Sertakan project-based learning yang bermakna

Buatlah RPP yang benar-benar profesional, siap pakai, dan dapat menjadi rujukan bagi guru lain!`;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        max_tokens: 3000,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    console.log('API failed, using fallback content');
                    return fallbackRPM;
                }

                const result = await response.json();
                return result.choices[0].message.content;
            } catch (error) {
                console.log('API error, using fallback content:', error);
                return fallbackRPM;
            }
        }

        function displayRPM(content, data) {
            console.log('displayRPM called with:', { content: content.substring(0, 100) + '...', data });
            generatedRPM = { content, data };
            
            const rppContainer = document.getElementById('rppContentContainer');
            console.log('rppContainer found:', rppContainer);
            
            if (!rppContainer) {
                console.error('RPP Container not found!');
                return;
            }
            
            // Show the preview section first
            const previewSection = document.getElementById('previewSection');
            if (previewSection) {
                previewSection.classList.remove('hidden');
                console.log('Preview section shown');
            }
            
            // Enhanced content formatting with better structure and table support
            const formattedContent = content
                .replace(/\*\*(.*?)\*\*/g, '<h3 class="text-xl font-bold text-burnt-orange mt-6 mb-4 retro-font flex items-center gap-2"><span class="text-2xl">üìö</span>$1</h3>')
                // Format tables
                .replace(/\|(.+)\|/g, function(match, content) {
                    const cells = content.split('|').map(cell => cell.trim()).filter(cell => cell);
                    if (cells.every(cell => cell.includes('-'))) {
                        return ''; // Skip separator rows
                    }
                    const isHeader = content.includes('No') || content.includes('Aspek') || content.includes('Tahap');
                    const cellClass = isHeader ? 'bg-teal text-white font-bold' : 'bg-cream/50';
                    const cellTag = isHeader ? 'th' : 'td';
                    return `<tr>${cells.map(cell => `<${cellTag} class="${cellClass} border border-gray-300 px-3 py-2 text-sm">${cell}</${cellTag}>`).join('')}</tr>`;
                })
                .replace(/(<tr>.*?<\/tr>)/gs, '<table class="w-full border-collapse border border-gray-400 mb-6 shadow-lg rounded-lg overflow-hidden">$1</table>')
                .replace(/(\d+\.\s.*?)(?=\n|$)/g, '<div class="bg-cream/30 p-4 rounded-xl border-l-4 border-teal mb-3"><p class="font-semibold text-olive">$1</p></div>')
                .replace(/([A-Z]\.\s.*?)(?=\n|$)/g, '<div class="bg-mustard/10 p-3 rounded-lg mb-2"><p class="font-medium text-gray-800">$1</p></div>')
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0)
                .map(line => {
                    if (line.includes('<h3') || line.includes('<table') || line.includes('<tr') || line.includes('<div')) return line;
                    if (line.includes('**')) return line;
                    if (line.match(/^\d+\./)) return line;
                    if (line.match(/^[A-Z]\./)) return line;
                    if (line.startsWith('|')) return line; // Skip table rows that weren't processed
                    return `<p class="mb-3 text-gray-700 leading-relaxed">${line}</p>`;
                })
                .join('');
            
            rppContainer.innerHTML = `
                <!-- Document Header with Vintage Style -->
                <div class="text-center mb-12 pb-8 border-b-4 border-mustard/30">
                    ${data.logoSekolah ? `<img src="${data.logoSekolah}" alt="Logo Sekolah" class="mx-auto mb-6 h-20 w-20 object-contain rounded-full border-4 border-teal/30 shadow-lg">` : ''}
                    <div class="bg-teal/10 p-6 rounded-2xl border-2 border-teal/20 mb-4">
                        <h1 class="retro-font text-3xl font-bold text-teal mb-3">RENCANA PELAKSANAAN PEMBELAJARAN</h1>
                        <h2 class="text-2xl font-bold text-burnt-orange">${data.namaSekolah}</h2>
                        <p class="text-lg text-olive font-semibold mt-2">Tahun Ajaran ${data.tahunAjaran}</p>
                    </div>
                    
                    <!-- Creator Attribution -->
                    <div class="bg-gradient-to-r from-mustard/20 to-teal/20 p-4 rounded-xl border-2 border-mustard/30">
                        <p class="text-sm font-semibold text-gray-700">
                            üë®‚Äçüç≥ <span class="text-teal">Dokumen ini di racik oleh Bapak Ari Wijaya</span>
                        </p>
                    </div>
                </div>
                
                <!-- Document Information Table -->
                <div class="mb-8">
                    <div class="bg-gradient-to-r from-cream/80 to-white p-6 rounded-2xl border-4 border-mustard/30 shadow-lg">
                        <h3 class="retro-font text-xl text-burnt-orange mb-4">üìã IDENTITAS PEMBELAJARAN</h3>
                        <table class="w-full text-base">
                            <tr class="border-b border-mustard/20">
                                <td class="font-bold text-olive py-3 w-1/3">Mata Pelajaran</td>
                                <td class="py-3">: <span class="font-semibold text-gray-800">${data.mataPelajaran}</span></td>
                            </tr>
                            <tr class="border-b border-mustard/20">
                                <td class="font-bold text-olive py-3">Kelas</td>
                                <td class="py-3">: <span class="font-semibold text-gray-800">${data.kelas}</span></td>
                            </tr>
                            <tr class="border-b border-mustard/20">
                                <td class="font-bold text-olive py-3">Guru Pengampu</td>
                                <td class="py-3">: <span class="font-semibold text-gray-800">${data.namaGuru}</span></td>
                            </tr>
                            <tr class="border-b border-mustard/20">
                                <td class="font-bold text-olive py-3">NIP Guru</td>
                                <td class="py-3">: <span class="font-semibold text-gray-800">${data.nipGuru}</span></td>
                            </tr>
                            <tr>
                                <td class="font-bold text-olive py-3">Frase</td>
                                <td class="py-3">: <span class="font-semibold text-teal">${data.frase}</span></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <!-- Main RPP Content -->
                <div class="prose max-w-none">
                    <div class="bg-gradient-to-br from-white via-cream/20 to-white p-8 rounded-2xl border-2 border-teal/20 shadow-inner">
                        <div class="text-base leading-7">${formattedContent}</div>
                    </div>
                </div>
                
                <!-- Signature Section -->
                <div class="mt-16 pt-8 border-t-4 border-mustard/30">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                        <div class="text-center bg-cream/50 p-6 rounded-2xl border-2 border-olive/30">
                            <h4 class="font-bold text-olive mb-2">Mengetahui,</h4>
                            <p class="font-semibold text-gray-700 mb-20">Kepala Sekolah</p>
                            <div class="border-t-2 border-gray-400 pt-2">
                                <p class="font-bold text-gray-800">${data.namaKepsek}</p>
                                <p class="text-gray-600">NIP. ${data.nipKepsek}</p>
                            </div>
                        </div>
                        <div class="text-center bg-cream/50 p-6 rounded-2xl border-2 border-teal/30">
                            <h4 class="font-bold text-teal mb-2">Guru Mata Pelajaran</h4>
                            <p class="font-semibold text-gray-700 mb-20">${data.mataPelajaran}</p>
                            <div class="border-t-2 border-gray-400 pt-2">
                                <p class="font-bold text-gray-800">${data.namaGuru}</p>
                                <p class="text-gray-600">NIP. ${data.nipGuru}</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Footer Attribution -->
                <div class="mt-12 text-center">
                    <div class="bg-gradient-to-r from-teal/10 to-mustard/10 p-4 rounded-xl border border-teal/20">
                        <p class="text-sm text-gray-600">
                            üë®‚Äçüç≥ <strong>Dokumen ini di racik oleh Bapak Ari Wijaya</strong>
                        </p>
                    </div>
                </div>
            `;
            
            console.log('RPP content updated in DOM');
        }

        // Setup semua event listeners setelah DOM loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Success popup close functionality
            const closePopupBtn = document.getElementById('closeSuccessPopup');
            if (closePopupBtn) {
                closePopupBtn.addEventListener('click', function() {
                    document.getElementById('successPopup').classList.remove('show');
                    document.getElementById('previewSection').classList.remove('hidden');
                    document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });
                });
            }

            // Download functionality
            const downloadWordBtn = document.getElementById('downloadWord');
            if (downloadWordBtn) {
                downloadWordBtn.addEventListener('click', function() {
                    if (!generatedRPP) return;
                    downloadAsWord();
                });
            }

            const downloadExcelBtn = document.getElementById('downloadExcel');
            if (downloadExcelBtn) {
                downloadExcelBtn.addEventListener('click', function() {
                    if (!generatedRPP) return;
                    downloadAsExcel();
                });
            }

            // Donation popup functionality
            const donationBtn = document.getElementById('donationBtn');
            const donationPopup = document.getElementById('donationPopup');
            const closeDonationPopup = document.getElementById('closeDonationPopup');
            const copyAccountBtn = document.getElementById('copyAccountBtn');

            if (donationBtn) {
                donationBtn.addEventListener('click', function() {
                    donationPopup.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                    // Add animation
                    setTimeout(() => {
                        donationPopup.querySelector('div > div').classList.add('scale-100');
                        donationPopup.querySelector('div > div').classList.remove('scale-95');
                    }, 10);
                });
            }

            if (closeDonationPopup) {
                closeDonationPopup.addEventListener('click', function() {
                    donationPopup.querySelector('div > div').classList.add('scale-95');
                    donationPopup.querySelector('div > div').classList.remove('scale-100');
                    setTimeout(() => {
                        donationPopup.classList.add('hidden');
                        document.body.style.overflow = 'auto';
                    }, 300);
                });
            }

            // Close popup when clicking outside
            if (donationPopup) {
                donationPopup.addEventListener('click', function(e) {
                    if (e.target === donationPopup) {
                        closeDonationPopup.click();
                    }
                });
            }

            // Copy account number functionality
            if (copyAccountBtn) {
                copyAccountBtn.addEventListener('click', async function() {
                    const accountNumber = document.getElementById('accountNumber').textContent;
                    
                    try {
                        // Modern clipboard API
                        if (navigator.clipboard && window.isSecureContext) {
                            await navigator.clipboard.writeText(accountNumber);
                            showCopySuccess();
                        } else {
                            // Fallback method for older browsers or non-HTTPS
                            const textArea = document.createElement('textarea');
                            textArea.value = accountNumber;
                            textArea.style.position = 'fixed';
                            textArea.style.left = '-999999px';
                            textArea.style.top = '-999999px';
                            document.body.appendChild(textArea);
                            textArea.focus();
                            textArea.select();
                            
                            const successful = document.execCommand('copy');
                            document.body.removeChild(textArea);
                            
                            if (successful) {
                                showCopySuccess();
                            } else {
                                throw new Error('Copy command failed');
                            }
                        }
                    } catch (error) {
                        console.error('Copy failed:', error);
                        // Final fallback - show alert with number
                        alert('Silakan salin nomor rekening ini:\n' + accountNumber);
                    }
                    
                    function showCopySuccess() {
                        // Change button text temporarily
                        const originalText = copyAccountBtn.innerHTML;
                        copyAccountBtn.innerHTML = '‚úÖ Tersalin!';
                        copyAccountBtn.classList.add('bg-green-500', 'hover:bg-green-600');
                        copyAccountBtn.classList.remove('bg-mustard', 'hover:bg-mustard/90');
                        
                        // Show success message
                        const successMsg = document.createElement('div');
                        successMsg.innerHTML = '‚úÖ Nomor rekening berhasil disalin!';
                        successMsg.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-xl shadow-lg z-50 font-semibold';
                        document.body.appendChild(successMsg);
                        
                        setTimeout(() => {
                            copyAccountBtn.innerHTML = originalText;
                            copyAccountBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                            copyAccountBtn.classList.add('bg-mustard', 'hover:bg-mustard/90');
                            
                            // Remove success message
                            if (successMsg.parentNode) {
                                successMsg.parentNode.removeChild(successMsg);
                            }
                        }, 2000);
                    }
                });
            }
        });

        function downloadAsWord() {
            const data = generatedRPP.data;
            const content = generatedRPP.content;
            
            // Enhanced content formatting to match preview exactly
            const cleanContent = content
                .replace(/\*\*(.*?)\*\*/g, '<h3 style="color: #CC6B49; font-size: 16pt; font-weight: bold; margin-top: 24px; margin-bottom: 16px; display: flex; align-items: center;"><span style="font-size: 18pt; margin-right: 8px;">üìö</span>$1</h3>')
                // Format tables with exact preview styling
                .replace(/\|(.+)\|/g, function(match, content) {
                    const cells = content.split('|').map(cell => cell.trim()).filter(cell => cell);
                    if (cells.every(cell => cell.includes('-'))) {
                        return ''; // Skip separator rows
                    }
                    const isHeader = content.includes('No') || content.includes('Aspek') || content.includes('Tahap');
                    const cellStyle = isHeader ? 
                        'background-color: #5C9EAD; color: white; font-weight: bold; padding: 12px 8px; border: 1px solid #333; text-align: center; font-size: 11pt;' : 
                        'background-color: #F5F1E8; padding: 12px 8px; border: 1px solid #333; vertical-align: top; font-size: 10pt; line-height: 1.4;';
                    const cellTag = isHeader ? 'th' : 'td';
                    return `<tr>${cells.map(cell => `<${cellTag} style="${cellStyle}">${cell}</${cellTag}>`).join('')}</tr>`;
                })
                .replace(/(<tr>.*?<\/tr>)/gs, '<table style="width: 100%; border-collapse: collapse; margin: 20px 0; box-shadow: 0 4px 8px rgba(0,0,0,0.1); border-radius: 8px; overflow: hidden;">$1</table>')
                .replace(/(\d+\.\s.*?)(?=\n|$)/g, '<div style="background-color: #F5F1E8; padding: 16px; border-radius: 12px; border-left: 4px solid #5C9EAD; margin: 12px 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1);"><p style="margin: 0; font-weight: 600; color: #8B956D; font-size: 11pt;">$1</p></div>')
                .replace(/([A-Z]\.\s.*?)(?=\n|$)/g, '<div style="background-color: #D4A574; background-color: rgba(212, 165, 116, 0.1); padding: 12px; border-radius: 8px; margin: 8px 0;"><p style="margin: 0; font-weight: 500; color: #333; font-size: 11pt;">$1</p></div>')
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0)
                .map(line => {
                    if (line.includes('<h3') || line.includes('<table') || line.includes('<tr') || line.includes('<div')) return line;
                    if (line.includes('**')) return line;
                    if (line.match(/^\d+\./)) return line;
                    if (line.match(/^[A-Z]\./)) return line;
                    if (line.startsWith('|')) return line;
                    return `<p style="margin-bottom: 12px; text-align: justify; line-height: 1.7; color: #374151; font-size: 11pt;">${line}</p>`;
                })
                .join('');

            const wordDocument = `
                <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                    <meta charset="utf-8">
                    <meta name="ProgId" content="Word.Document">
                    <meta name="Generator" content="Microsoft Word 15">
                    <meta name="Originator" content="Microsoft Word 15">
                    <style>
                        @page { 
                            size: A4; 
                            margin: 2.5cm 2cm 2cm 2cm; 
                            mso-page-orientation: portrait;
                        }
                        body { 
                            font-family: 'Inter', 'Segoe UI', 'Times New Roman', serif; 
                            font-size: 11pt; 
                            line-height: 1.7; 
                            color: #374151; 
                            margin: 0;
                            padding: 0;
                            background: linear-gradient(45deg, #f9f7f4 25%, transparent 25%), 
                                        linear-gradient(-45deg, #f9f7f4 25%, transparent 25%), 
                                        linear-gradient(45deg, transparent 75%, #f9f7f4 75%), 
                                        linear-gradient(-45deg, transparent 75%, #f9f7f4 75%);
                            background-size: 20px 20px;
                            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
                        }
                        .document-container {
                            background: linear-gradient(135deg, #ffffff 0%, #F5F1E8 30%, #ffffff 100%);
                            padding: 48px;
                            border-radius: 24px;
                            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
                            border: 4px solid rgba(212, 165, 116, 0.3);
                            position: relative;
                            overflow: hidden;
                        }
                        .document-container::before {
                            content: '';
                            position: absolute;
                            top: 16px; left: 16px; width: 8px; height: 8px;
                            background: rgba(212, 165, 116, 0.2);
                            border-radius: 50%;
                        }
                        .document-container::after {
                            content: '';
                            position: absolute;
                            top: 16px; right: 16px; width: 8px; height: 8px;
                            background: rgba(92, 158, 173, 0.2);
                            border-radius: 50%;
                        }
                        .header-section {
                            text-align: center;
                            margin-bottom: 48px;
                            padding-bottom: 32px;
                            border-bottom: 4px solid rgba(212, 165, 116, 0.3);
                        }
                        .header-box {
                            background: rgba(92, 158, 173, 0.1);
                            padding: 24px;
                            border-radius: 16px;
                            border: 2px solid rgba(92, 158, 173, 0.2);
                            margin-bottom: 16px;
                        }
                        .creator-attribution {
                            background: linear-gradient(90deg, rgba(212, 165, 116, 0.2) 0%, rgba(92, 158, 173, 0.2) 100%);
                            padding: 16px;
                            border-radius: 12px;
                            border: 2px solid rgba(212, 165, 116, 0.3);
                            margin-top: 16px;
                        }
                        h1 { 
                            color: #5C9EAD; 
                            text-align: center; 
                            font-size: 24pt; 
                            font-weight: bold;
                            margin: 12px 0; 
                            text-transform: uppercase;
                            font-family: 'Righteous', cursive;
                        }
                        h2 { 
                            color: #CC6B49; 
                            font-size: 20pt; 
                            font-weight: bold;
                            margin: 8px 0; 
                            text-align: center;
                        }
                        h3 { 
                            color: #CC6B49; 
                            font-size: 16pt; 
                            font-weight: bold;
                            margin: 24px 0 16px 0;
                            font-family: 'Righteous', cursive;
                        }
                        .identity-table { 
                            border-collapse: collapse; 
                            width: 100%; 
                            margin: 32px 0;
                            font-size: 12pt;
                            background: linear-gradient(135deg, #F5F1E8 0%, #ffffff 100%);
                            border-radius: 16px;
                            overflow: hidden;
                            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
                            border: 4px solid rgba(212, 165, 116, 0.3);
                        }
                        .identity-table td { 
                            padding: 16px 20px; 
                            border-bottom: 1px solid rgba(212, 165, 116, 0.2); 
                            vertical-align: top; 
                        }
                        .identity-table td:first-child {
                            font-weight: bold; 
                            color: #8B956D;
                            width: 33%;
                        }
                        .content-wrapper {
                            background: linear-gradient(135deg, #ffffff 0%, rgba(245, 241, 232, 0.2) 100%);
                            padding: 32px;
                            border-radius: 16px;
                            border: 2px solid rgba(92, 158, 173, 0.2);
                            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
                            margin: 32px 0;
                        }
                        table { 
                            border-collapse: collapse; 
                            width: 100%; 
                            margin: 20px 0;
                            font-size: 10pt;
                            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                            border-radius: 8px;
                            overflow: hidden;
                        }
                        th { 
                            background-color: #5C9EAD; 
                            color: white; 
                            font-weight: bold; 
                            padding: 12px 8px; 
                            border: 1px solid #333; 
                            text-align: center; 
                            font-size: 11pt;
                        }
                        td { 
                            background-color: #F5F1E8; 
                            padding: 12px 8px; 
                            border: 1px solid #333; 
                            vertical-align: top; 
                            font-size: 10pt; 
                            line-height: 1.4;
                        }
                        .signature-section {
                            margin-top: 64px;
                            padding-top: 32px;
                            border-top: 4px solid rgba(212, 165, 116, 0.3);
                            page-break-inside: avoid;
                        }
                        .signature-table {
                            width: 100%;
                            border: none;
                            margin: 48px 0;
                        }
                        .signature-table td {
                            border: none;
                            text-align: center;
                            vertical-align: top;
                            padding: 24px;
                            background: rgba(245, 241, 232, 0.5);
                            border-radius: 16px;
                            margin: 0 12px;
                        }
                        .signature-table td:first-child {
                            border: 2px solid rgba(139, 149, 109, 0.3);
                        }
                        .signature-table td:last-child {
                            border: 2px solid rgba(92, 158, 173, 0.3);
                        }
                        .signature-line {
                            border-top: 2px solid #333;
                            margin-top: 80px;
                            padding-top: 8px;
                        }
                        .footer-attribution {
                            text-align: center;
                            font-size: 11pt;
                            color: #666;
                            margin-top: 48px;
                            background: linear-gradient(90deg, rgba(92, 158, 173, 0.1) 0%, rgba(212, 165, 116, 0.1) 100%);
                            padding: 16px;
                            border-radius: 12px;
                            border: 1px solid rgba(92, 158, 173, 0.2);
                        }
                    </style>
                </head>
                <body>
                    <div class="document-container">
                        <!-- Document Header -->
                        <div class="header-section">
                            ${data.logoSekolah ? `<img src="${data.logoSekolah}" alt="Logo Sekolah" style="height: 80px; width: 80px; object-fit: contain; margin-bottom: 24px; border-radius: 50%; border: 4px solid rgba(92, 158, 173, 0.3); box-shadow: 0 4px 8px rgba(0,0,0,0.1);">` : ''}
                            <div class="header-box">
                                <h1>RENCANA PEMBELAJARAN MENDALAM</h1>
                                <h2>${data.namaSekolah}</h2>
                                <p style="font-size: 14pt; font-weight: 600; margin-top: 8px; color: #8B956D;">Tahun Ajaran ${data.tahunAjaran}</p>
                            </div>
                            <div class="creator-attribution">
                                <p style="font-size: 11pt; font-weight: 600; color: #374151; margin: 0;">
                                    üë®‚Äçüç≥ <span style="color: #5C9EAD;">Dokumen ini di racik oleh Bapak Ari Wijaya</span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- Identity Table -->
                        <div style="margin-bottom: 32px;">
                            <h3 style="color: #CC6B49; margin-bottom: 16px; font-family: 'Righteous', cursive; display: flex; align-items: center;"><span style="font-size: 18pt; margin-right: 8px;">üìã</span>IDENTITAS PEMBELAJARAN</h3>
                            <table class="identity-table">
                                <tr>
                                    <td>Mata Pelajaran</td>
                                    <td>: <span style="font-weight: 600; color: #374151;">${data.mataPelajaran}</span></td>
                                </tr>
                                <tr>
                                    <td>Kelas</td>
                                    <td>: <span style="font-weight: 600; color: #374151;">${data.kelas}</span></td>
                                </tr>
                                <tr>
                                    <td>Guru Pengampu</td>
                                    <td>: <span style="font-weight: 600; color: #374151;">${data.namaGuru}</span></td>
                                </tr>
                                <tr>
                                    <td>NIP Guru</td>
                                    <td>: <span style="font-weight: 600; color: #374151;">${data.nipGuru}</span></td>
                                </tr>
                                <tr>
                                    <td>Frase</td>
                                    <td>: <strong style="color: #5C9EAD; font-weight: 600;">${data.frase}</strong></td>
                                </tr>
                            </table>
                        </div>
                        
                        <!-- Main Content -->
                        <div class="content-wrapper">
                            ${cleanContent}
                        </div>
                        
                        <!-- Signature Section -->
                        <div class="signature-section">
                            <table class="signature-table">
                                <tr>
                                    <td style="width: 50%;">
                                        <h4 style="font-weight: bold; margin-bottom: 8px; color: #8B956D;">Mengetahui,</h4>
                                        <p style="font-weight: 600; margin-bottom: 80px; color: #374151;">Kepala Sekolah</p>
                                        <div class="signature-line">
                                            <p style="font-weight: bold; margin: 8px 0; color: #374151;">${data.namaKepsek}</p>
                                            <p style="color: #666;">NIP. ${data.nipKepsek}</p>
                                        </div>
                                    </td>
                                    <td style="width: 50%;">
                                        <h4 style="font-weight: bold; margin-bottom: 8px; color: #5C9EAD;">Guru Mata Pelajaran</h4>
                                        <p style="font-weight: 600; margin-bottom: 80px; color: #374151;">${data.mataPelajaran}</p>
                                        <div class="signature-line">
                                            <p style="font-weight: bold; margin: 8px 0; color: #374151;">${data.namaGuru}</p>
                                            <p style="color: #666;">NIP. ${data.nipGuru}</p>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>
                        
                        <!-- Footer -->
                        <div class="footer-attribution">
                            <p style="margin: 0;"><strong>Dokumen ini di racik oleh Bapak Ari Wijaya</strong></p>
                        </div>
                    </div>
                </body>
                </html>
            `;
            
            const blob = new Blob([wordDocument], { type: 'application/msword' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `RPP_${data.mataPelajaran}_${data.kelas}.doc`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function downloadAsExcel() {
            const data = generatedRPP.data;
            const content = generatedRPP.content;
            
            // Enhanced content formatting to match preview exactly
            const cleanContent = content
                .replace(/\*\*(.*?)\*\*/g, '<strong style="color: #CC6B49; font-size: 14pt;">üìö $1</strong>')
                // Format tables with exact preview styling
                .replace(/\|(.+)\|/g, function(match, content) {
                    const cells = content.split('|').map(cell => cell.trim()).filter(cell => cell);
                    if (cells.every(cell => cell.includes('-'))) {
                        return ''; // Skip separator rows
                    }
                    const isHeader = content.includes('No') || content.includes('Aspek') || content.includes('Tahap');
                    const cellStyle = isHeader ? 
                        'background-color: #5C9EAD; color: white; font-weight: bold; padding: 8px; border: 1px solid #333; text-align: center; font-size: 10pt;' : 
                        'background-color: #F5F1E8; padding: 8px; border: 1px solid #333; vertical-align: top; font-size: 9pt; line-height: 1.3;';
                    const cellTag = isHeader ? 'th' : 'td';
                    return `<tr>${cells.map(cell => `<${cellTag} style="${cellStyle}">${cell}</${cellTag}>`).join('')}</tr>`;
                })
                .replace(/(<tr>.*?<\/tr>)/gs, '<table style="width: 100%; border-collapse: collapse; margin: 10px 0; border-radius: 4px; overflow: hidden;">$1</table>')
                .replace(/(\d+\.\s.*?)(?=\n|$)/g, '<div style="background-color: #F5F1E8; padding: 8px; border-left: 3px solid #5C9EAD; margin: 6px 0;"><strong style="color: #8B956D; font-size: 10pt;">$1</strong></div>')
                .replace(/([A-Z]\.\s.*?)(?=\n|$)/g, '<div style="background-color: rgba(212, 165, 116, 0.1); padding: 6px; margin: 4px 0;"><span style="font-size: 10pt;">$1</span></div>')
                .split('\n')
                .map(line => line.trim())
                .filter(line => line.length > 0)
                .map(line => {
                    if (line.includes('<strong') || line.includes('<table') || line.includes('<tr') || line.includes('<div')) return line;
                    if (line.includes('**')) return line;
                    if (line.match(/^\d+\./)) return line;
                    if (line.match(/^[A-Z]\./)) return line;
                    if (line.startsWith('|')) return line;
                    return `<p style="margin: 4px 0; text-align: justify; line-height: 1.4; color: #374151; font-size: 10pt;">${line}</p>`;
                })
                .join('');
            
            // Create structured Excel content with enhanced formatting to match preview
            const excelContent = `
                <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
                <head>
                    <meta charset="utf-8">
                    <meta name="ProgId" content="Excel.Sheet">
                    <meta name="Generator" content="Microsoft Excel 15">
                    <style>
                        body {
                            font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
                            font-size: 10pt;
                            line-height: 1.4;
                            color: #374151;
                        }
                        .document-header { 
                            background: linear-gradient(135deg, #5C9EAD 0%, #4A8A9A 100%); 
                            color: white; 
                            font-weight: bold; 
                            text-align: center; 
                            padding: 15px;
                            font-size: 16pt;
                            border-radius: 8px;
                        }
                        .school-header { 
                            background: linear-gradient(135deg, #CC6B49 0%, #B85A3E 100%); 
                            color: white; 
                            font-weight: bold; 
                            text-align: center; 
                            padding: 12px;
                            font-size: 14pt;
                        }
                        .year-header { 
                            background: linear-gradient(135deg, #8B956D 0%, #7A8460 100%); 
                            color: white; 
                            font-weight: bold; 
                            text-align: center; 
                            padding: 10px;
                            font-size: 12pt;
                        }
                        .section-header { 
                            background: linear-gradient(135deg, #D4A574 0%, #C19660 100%); 
                            color: white; 
                            font-weight: bold; 
                            text-align: center;
                            padding: 12px;
                            font-size: 12pt;
                        }
                        .identity-label { 
                            background-color: #8B956D; 
                            color: white; 
                            font-weight: bold; 
                            padding: 10px;
                            width: 35%;
                            font-size: 11pt;
                        }
                        .identity-data { 
                            background-color: #F5F1E8; 
                            padding: 10px;
                            font-weight: 600;
                            color: #374151;
                            font-size: 11pt;
                        }
                        .content-section { 
                            background: linear-gradient(135deg, #ffffff 0%, #F5F1E8 100%); 
                            padding: 20px;
                            vertical-align: top; 
                            line-height: 1.6;
                            border: 2px solid #D4A574;
                        }
                        .footer-section { 
                            background: linear-gradient(135deg, #5C9EAD 0%, #D4A574 100%); 
                            color: white; 
                            font-weight: bold; 
                            text-align: center;
                            padding: 15px;
                            font-size: 11pt;
                        }
                        .creator-attribution {
                            background: linear-gradient(90deg, rgba(212, 165, 116, 0.2) 0%, rgba(92, 158, 173, 0.2) 100%);
                            padding: 10px;
                            text-align: center;
                            font-size: 10pt;
                            color: #5C9EAD;
                            font-weight: 600;
                        }
                        .signature-section {
                            background-color: #F5F1E8;
                            padding: 15px;
                            text-align: center;
                            border: 1px solid #D4A574;
                        }
                        .signature-left {
                            background-color: rgba(139, 149, 109, 0.1);
                            padding: 12px;
                            border: 2px solid rgba(139, 149, 109, 0.3);
                            border-radius: 8px;
                        }
                        .signature-right {
                            background-color: rgba(92, 158, 173, 0.1);
                            padding: 12px;
                            border: 2px solid rgba(92, 158, 173, 0.3);
                            border-radius: 8px;
                        }
                        table { border-collapse: collapse; width: 100%; }
                        td { border: 1px solid #ccc; vertical-align: top; }
                        .no-border { border: none; }
                        .spacing-row { height: 20px; background-color: transparent; }
                    </style>
                </head>
                <body>
                    <table border="1" style="width: 100%; border-collapse: collapse;">
                        <!-- Document Header -->
                        <tr>
                            <td colspan="2" class="document-header">
                                üìö RENCANA PELAKSANAAN PEMBELAJARAN
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" class="school-header">
                                üè´ ${data.namaSekolah}
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" class="year-header">
                                üìÖ Tahun Ajaran ${data.tahunAjaran}
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" class="creator-attribution">
                                üë®‚Äçüç≥ <strong>Dokumen ini di racik oleh Bapak Ari Wijaya</strong>
                            </td>
                        </tr>
                        
                        <!-- Spacing -->
                        <tr class="spacing-row">
                            <td colspan="2" class="no-border"></td>
                        </tr>
                        
                        <!-- Identity Section -->
                        <tr>
                            <td colspan="2" class="section-header">
                                üìã IDENTITAS PEMBELAJARAN
                            </td>
                        </tr>
                        <tr>
                            <td class="identity-label">üìö Mata Pelajaran</td>
                            <td class="identity-data">: ${data.mataPelajaran}</td>
                        </tr>
                        <tr>
                            <td class="identity-label">üéì Kelas</td>
                            <td class="identity-data">: ${data.kelas}</td>
                        </tr>
                        <tr>
                            <td class="identity-label">üë®‚Äçüè´ Guru Pengampu</td>
                            <td class="identity-data">: ${data.namaGuru}</td>
                        </tr>
                        <tr>
                            <td class="identity-label">üÜî NIP Guru</td>
                            <td class="identity-data">: ${data.nipGuru}</td>
                        </tr>
                        <tr>
                            <td class="identity-label">üë®‚Äçüíº Kepala Sekolah</td>
                            <td class="identity-data">: ${data.namaKepsek}</td>
                        </tr>
                        <tr>
                            <td class="identity-label">üÜî NIP Kepala Sekolah</td>
                            <td class="identity-data">: ${data.nipKepsek}</td>
                        </tr>
                        <tr>
                            <td class="identity-label">üéØ Frase/Tema</td>
                            <td class="identity-data">: <strong style="color: #5C9EAD;">${data.frase}</strong></td>
                        </tr>
                        
                        <!-- Spacing -->
                        <tr class="spacing-row">
                            <td colspan="2" class="no-border"></td>
                        </tr>
                        
                        <!-- Main Content Section -->
                        <tr>
                            <td colspan="2" class="section-header">
                                üìù KONTEN RPP LENGKAP
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" class="content-section">
                                ${cleanContent}
                            </td>
                        </tr>
                        
                        <!-- Spacing -->
                        <tr class="spacing-row">
                            <td colspan="2" class="no-border"></td>
                        </tr>
                        
                        <!-- Signature Section -->
                        <tr>
                            <td colspan="2" class="section-header">
                                ‚úçÔ∏è TANDA TANGAN
                            </td>
                        </tr>
                        <tr>
                            <td class="signature-left">
                                <strong style="color: #8B956D;">Mengetahui,</strong><br>
                                <strong>Kepala Sekolah</strong><br><br><br><br>
                                <div style="border-top: 2px solid #333; padding-top: 5px; margin-top: 60px;">
                                    <strong>${data.namaKepsek}</strong><br>
                                    <span style="color: #666;">NIP. ${data.nipKepsek}</span>
                                </div>
                            </td>
                            <td class="signature-right">
                                <strong style="color: #5C9EAD;">Guru Mata Pelajaran</strong><br>
                                <strong>${data.mataPelajaran}</strong><br><br><br><br>
                                <div style="border-top: 2px solid #333; padding-top: 5px; margin-top: 60px;">
                                    <strong>${data.namaGuru}</strong><br>
                                    <span style="color: #666;">NIP. ${data.nipGuru}</span>
                                </div>
                            </td>
                        </tr>
                        
                        <!-- Footer -->
                        <tr>
                            <td colspan="2" class="footer-section">
                                üéâ Dokumen ini di racik oleh Bapak Ari Wijaya - Dedikasi untuk Guru Indonesia üáÆüá©
                            </td>
                        </tr>
                    </table>
                </body>
                </html>
            `;
            
            const blob = new Blob([excelContent], { type: 'application/vnd.ms-excel' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `RPP_${data.mataPelajaran}_${data.kelas}.xls`;
            a.click();
            URL.revokeObjectURL(url);
        }


    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96f083af8073fe21',t:'MTc1NTE3NTE2MC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
